<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ajedrez 3D con Animaciones</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #111;
    }
    #canvas-container {
      width: 100vw;
      height: 100vh;
    }
    #mensaje-captura {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.1);
      color: #0ff;
      font-size: 24px;
      padding: 10px 20px;
      border: 2px solid #0ff;
      border-radius: 10px;
      display: none;
      z-index: 2;
    }
  </style>
</head>
<body>
  <div id="canvas-container"></div>
  <div id="mensaje-captura">¡Captura estratégica!</div>
  <audio id="audio-captura" src="https://cdn.pixabay.com/audio/2022/03/15/audio_5ff57e3f54.mp3"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r150/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/examples/js/loaders/GLTFLoader.js"></script>
  <script>
    let scene, camera, renderer;
    let caballo, torre, piezaCapturada;
    const container = document.getElementById('canvas-container');
    const mensajeCaptura = document.getElementById('mensaje-captura');
    const sonidoCaptura = document.getElementById('audio-captura');

    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x222222);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(6, 10, 10);
      camera.lookAt(0, 0, 0);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      container.appendChild(renderer.domElement);

      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);

      const pointLight = new THREE.PointLight(0xffffff, 1);
      pointLight.position.set(5, 10, 5);
      scene.add(pointLight);

      crearTablero();
      cargarModelos();
    }

    function crearTablero() {
      const size = 8;
      const squareSize = 1;
      const blanco = new THREE.MeshStandardMaterial({ color: 0xdddddd });
      const negro = new THREE.MeshStandardMaterial({ color: 0x333333 });

      for (let x = 0; x < size; x++) {
        for (let z = 0; z < size; z++) {
          const material = (x + z) % 2 === 0 ? blanco : negro;
          const square = new THREE.Mesh(new THREE.BoxGeometry(squareSize, 0.1, squareSize), material);
          square.position.set(x - size / 2 + 0.5, -0.05, z - size / 2 + 0.5);
          scene.add(square);
        }
      }
    }

    function cargarModelos() {
      const loader = new THREE.GLTFLoader();

      loader.load(
        'https://cdn.jsdelivr.net/gh/KhronosGroup/glTF-Sample-Models@master/2.0/ChessSet/glTF/ChessSet.gltf',
        function (gltf) {
          const modelo = gltf.scene;
          modelo.scale.set(0.3, 0.3, 0.3);

          // Torre
          torre = modelo.clone();
          torre.position.set(0, 0, -3);
          scene.add(torre);

          // Caballo
          caballo = modelo.clone();
          caballo.position.set(3, 0, 0);
          scene.add(caballo);

          // Pieza capturada
          piezaCapturada = modelo.clone();
          piezaCapturada.position.set(-3, 0, 0);
          scene.add(piezaCapturada);

          iniciarAnimaciones();
        },
        undefined,
        function (error) {
          console.error('Error al cargar el modelo:', error);
        }
      );
    }

    function iniciarAnimaciones() {
      setTimeout(animarCaballo, 1000);
      setTimeout(animarTorre, 3000);
      setTimeout(() => animarCaptura(piezaCapturada), 5000);
    }

    function animarCaballo() {
      let start = null;
      const duracion = 1500;

      function mover(tiempo) {
        if (!start) start = tiempo;
        const progreso = (tiempo - start) / duracion;
        caballo.position.x = 3 - progreso * 6;
        caballo.position.y = Math.sin(progreso * 10 * Math.PI) * 0.5;

        if (progreso < 1) requestAnimationFrame(mover);
        else caballo.position.y = 0;
      }

      requestAnimationFrame(mover);
    }

    function animarTorre() {
      let start = null;
      const duracion = 1000;

      function mover(tiempo) {
        if (!start) start = tiempo;
        const progreso = (tiempo - start) / duracion;
        torre.position.z = -3 + progreso * 6;

        if (progreso < 1) requestAnimationFrame(mover);
      }

      requestAnimationFrame(mover);
    }

    function animarCaptura(pieza) {
      const duracion = 1000;
      const inicio = performance.now();
      const escalaInicial = pieza.scale.clone();
      const escalaFinal = new THREE.Vector3(0.1, 0.1, 0.1);

      mensajeCaptura.style.display = 'block';
      sonidoCaptura.play();
      setTimeout(() => mensajeCaptura.style.display = 'none', 1200);

      function encoger(tiempo) {
        const transcurrido = tiempo - inicio;
        const t = Math.min(transcurrido / duracion, 1);
        pieza.scale.lerpVectors(escalaInicial, escalaFinal, t);
        if (t < 1) requestAnimationFrame(encoger);
        else scene.remove(pieza);
      }

      requestAnimationFrame(encoger);
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    init();
    animate();
  </script>
</body>
</html>
